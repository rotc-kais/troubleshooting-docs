---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# 清理流水线记录方法（TKE 2.6

已触发不执行

## Cause
- Jenkins watch global pipeline资源过多导致apiserver通信超时

## Resolution
- 清理流水线记录保留45天命令: for ns in $(kubectl get ns -oname |awk -F '/' '{print$2}');do kubectl delete pipeline -n $ns $(kubectl get pipeline -n $ns | awk 'match($4,/([1-9][0-9][0-9]d)|([5-9][0-9]d)|(4[6-9]d)/) {print $1}'); done
- 清理流水线记录保留15天命令: for ns in $(kubectl get ns -oname |awk -F '/' '{print$2}');do kubectl delete pipelines -n $ns $(kubectl get pipelines -n $ns | awk 'match($4,/([1-9][0-9][0-9]d)|([2-9][0-9]d)|(1[6-9]d)/) {print $1}'); done
- 清理流水线记录保留3天命令: for ns in $(kubectl get ns -oname |awk -F '/' '{print$2}');do kubectl delete pipelines -n $ns $(kubectl get pipelines -n $ns | awk 'match($4,/([1-9][0-9][0-9]d)|([1-9][0-9]d)|([4-9]d)/) {print $1}'); done
- 执行etcd compact和defrag操作

## [workaround]

## [Related Information]
- Environment: TKE 3.8以下
- pipeline
- pipelines
- etcd
- apiserver
- Jenkins
- Component: 流水线
- Page ID: 133094849
- Original Title: 清理流水线记录方法（TKE 2.6 - 3.4）
