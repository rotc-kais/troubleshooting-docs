---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# harbor迁移存储目录迁移到新盘

harbor使用的磁盘使用率达到91% harbor因存储已满处于宕机状态 节点被自动打上DiskPressure不可调度标签

## Cause
- harbor存储目录所在磁盘无法热扩容
- 原存储路径/Harbor所在磁盘空间不足
- 节点存在DiskPressure污点导致Pod无法调度

## Resolution
- kubectl scale --replicas=0 deploy -ncpaas-system devops-tools-operator
- kubectl scale --replicas=0 sts [habror sts name]; kubectl scale --replicas=0 deploy [harbor deploy name]
- mv /Harbor/* /cpaas/harbor.bak
- mkdir /cpaas/harbor; cp -arf /cpaas/harbor.bak/* /cpaas/harbor
- kubectl scale --replicas=2 deploy -ncpaas-system devops-tools-operator
- 通过operatorhub页面修改harbor存储路径为/cpaas/harbor
- 重启kubelet清理DiskPressure污点

## [workaround]

## [Related Information]
- Environment: TKE 3.4以上
- hostPath
- /cpaas/harbor
- devops-tools-operator
- DiskPressure
- kubelet
- Component: harbor
- Page ID: 130576738
- Original Title: harbor迁移存储目录迁移到新盘
