---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# registry

minio无法启动导致镜像无法拉取 minio报错：Unable to read 'format.json'，Expected storage API version 'v20'，实际发现'e1'或'e2'

## Cause
- minio存储API版本不兼容（v20与e1/e2版本冲突）

## Resolution
- 三节点master执行：mv /cpaas/minio /cpaas/minio-back
- 三节点master执行：docker ps -a | grep registry | xargs docker rm -f
- 在安装包主机执行：docker run --name mctmp --privileged --net=host --entrypoint=/bin/sh -v $PWD/registry:/registry ${REGISTRY_ENDPOINT}/3rdparty/mc:RELEASE.2020-09-03T00-08-28Z -c 'mc alias set miniocluster http://127.0.0.1:9000 ${aaaaaa} ${bbbbb} && mc cp --recursive /registry/docker/ miniocluster/registry/docker'

## [workaround]

## [Related Information]
- Environment: TKE3.0+
- /cpaas/minio
- registry.yaml
- MINIO_ACCESS_KEY
- MINIO_SECRET_KEY
- 9000端口
- minio
- registry服务
- Component: Harbor
- Page ID: 110135822
- Original Title: registry-minio集群故障修复方案
