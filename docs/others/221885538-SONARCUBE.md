---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# SONARCUBE

启动时日志报错：'Elasticsearch must be started first' 服务启动后立即退出，端口9000未监听 数据库连接失败，报错'Connection refused to PostgreSQL'

## Cause
- 启动顺序错误：Elasticsearch未作为依赖服务优先启动
- 端口冲突：已有进程占用9000端口
- 数据库配置错误：sonar.properties中jdbc.url配置异常

## Resolution
- 修改systemd unit文件，添加After=elasticsearch.service依赖
- 执行`netstat -tlnp | grep 9000`定位占用进程并终止
- 检查`sonar.properties`中`sonar.jdbc.url=jdbc:postgresql://localhost:5432/sonarqube`配置

## [workaround]
- 手动启动顺序：`systemctl start sonarqube-elasticsearch && systemctl start sonarqube`
- 临时修改`sonar.web.port=9001`规避端口冲突
- 验证数据库连通性：`psql -h 127.0.0.1 -p 5432 -U sonarqube -W`

## [Related Information]
- Environment: SonarQube 8.9 LTS, Docker部署于CentOS 7
- Elasticsearch
- PostgreSQL
- sonarqube主服务
- 9000/tcp
- 5432/tcp
- /opt/sonarqube/conf/sonar.properties
- Component: (待归类)
- Page ID: 221885538
- Original Title: SONARCUBE
