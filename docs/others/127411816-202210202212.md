---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# 2022.10~2022.12

Nginx Ingress Controller 返回 502 Bad Gateway 错误 特定后端 Pod 日志显示 connection refused 错误："upstream connect error or disconnect/reset before headers. reset reason: connection failure, transport failure reason: connection refused"

## Cause
- Service 未监听预期端口（80/443）
- Service 的 selector 与 Pod labels 不匹配
- NetworkPolicy 限制了入口流量
- Ingress 配置中 servicePort 指定错误

## Resolution
- 执行 kubectl get svc <service-name> -o jsonpath='{.spec.ports}' 验证端口映射
- 检查 Service selector 与 Pod labels 是否一致：kubectl get pods --show-labels
- 验证 NetworkPolicy 配置：kubectl get networkpolicy
- 确认 Ingress 中 servicePort 与 Service 定义一致

## [workaround]
- 重启关联的 Nginx Ingress Controller Pod：kubectl rollout restart deployment/nginx-ingress-controller -n ingress-nginx

## [Related Information]
- Environment: Kubernetes 1.24 集群，使用 Nginx Ingress Controller v1.5.1
- Service.spec.ports[*].targetPort
- Service.spec.selector
- NetworkPolicy.ingress
- Ingress.spec.rules[*].http.paths[*].backend.service.port.number
- kube-proxy
- CNI 插件
- Component: (待归类)
- Page ID: 127411816
- Original Title: 2022.10~2022.12
