---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# 基础架构（AIT）

Pod 处于 CrashLoopBackOff 状态 容器日志显示 'Failed to connect to database: connection refused' 就绪探针（readinessProbe）连续超时

## Cause
- 数据库服务 mysql-service:3306 无法访问
- 数据库连接字符串缺少 SSL 参数 useSSL=true
- 容器内存限制设置为 512Mi 导致 OOMKilled
- NetworkPolicy 未放行目标数据库端口

## Resolution
- 执行 kubectl get svc mysql-service -n db 验证服务状态
- 检查 deployment.yaml 中 envFrom 引用的 configmap/db-credentials
- 将 resources.requests.memory 调整为 1Gi 并添加 limits.memory: 2Gi
- 在 NetworkPolicy 中增加 egress 规则允许 3306/tcp

## [workaround]
- 临时设置 readinessProbe.timeoutSeconds=10 && kubectl patch deployment my-deploy -p '{"spec":{"template":{"spec":{"containers":[{"name":"app","readinessProbe":{"timeoutSeconds":10}}]}}}}'

## [Related Information]
- Environment: Kubernetes v1.22 集群使用 Calico CNI，后端数据库为 MySQL 5.7
- 3306/tcp
- /etc/app/config.yaml
- mysql-service
- NetworkPolicy
- spec.template.spec.containers.resources
- configmap/db-credentials
- Component: (待归类)
- Page ID: 214860223
- Original Title: 基础架构（AIT）
