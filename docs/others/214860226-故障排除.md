---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# 故障排除

审计事件未生成或内容不全 kube-apiserver日志出现Failed to audit log字样

## Cause
- 审计策略文件配置错误
- Webhook服务地址不可达
- 磁盘空间不足导致日志写入失败
- apiserver进程无审计目录写入权限
- kube-apiserver未配置--audit-log-path参数

## Resolution
- 检查/etc/kubernetes/audit/policy.yaml配置语法
- 执行curl -X POST -k https://audit-webhook:8443/audit测试webhook连通性
- 检查/var/log/k8s_audit目录磁盘使用率(df -h)
- 验证apiserver进程用户对审计目录的权限(ls -ld /var/log/k8s_audit)
- 确认kube-apiserver配置包含--audit-policy-file和--audit-log-path参数

## [workaround]
- 临时启用本地日志缓存：在apiserver配置中添加--audit-log-mode=batch

## [Related Information]
- Environment: Kubernetes 1.19+
- /etc/kubernetes/audit/policy.yaml
- audit-webhook:8443/audit
- kube-apiserver
- /var/log/k8s_audit
- --audit-log-maxbackup
- Component: (待归类)
- Page ID: 214860226
- Original Title: 故障排除-日志审计事件
