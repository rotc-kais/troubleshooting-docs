---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# 解析内部svc域名失败

A服务通过svc-name访问同ns下的B服务时连接被拒绝 dig查询svc域名返回REFUSED 无法ping通coredns-pod-ip

## Cause
- Calico的bug导致部分节点间无法建立网络连接，无法访问对端tunl0网卡ip

## Resolution
- kubectl cp -n kube-system `kubectl get pod -n kube-system|grep raven |awk 'NR==1{print $1}'`:/raven/calicoctl ./calicoctl
- chmod +x calicoctl
- export DATASTORE_TYPE=kubernetes
- export KUBECONFIG=/etc/kubernetes/admin.conf
- ./calicoctl get no -o yaml | grep -i tun | cut -d: -f2 > tunlip.txt
- 在tunlip.txt每行插入ping -c3 -W1
- crontab -e添加 */5 * * * * /bin/bash /root/tunlip.txt &>/dev/null

## [workaround]

## [Related Information]
- Environment: Kubernetes v2.9/v3.0 with Calico网络插件
- coredns
- calico
- tunl0
- cluster-ip
- svc域名
- calicoctl
- kube-system命名空间
- Component: CoreDNS
- Page ID: 115536768
- Original Title: 解析内部svc域名失败
