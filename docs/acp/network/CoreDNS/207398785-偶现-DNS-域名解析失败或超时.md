---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# 偶现 DNS 域名解析失败或超时

用户业务 Pod 中解析同 namespace 下的 Service 名称时偶现失败或超时 对 Pod 进行抓包，发现没有回包 CoreDNS 所在节点上有 ARP 表溢出的报错

## Cause
- ARP 表溢出导致丢包
- conntrack 表插入失败（可能内核 bug）

## Resolution
- 调整 net.ipv4.neigh.default.gc_thresh1/net.ipv4.neigh.default.gc_thresh2/net.ipv4.neigh.default.gc_thresh3 为当前的四倍，并写入 sysctl.conf
- 重建 Pod
- 手动删除 connntrack 中的 UDP entry

## [workaround]

## [Related Information]
**Screenshots**
![](assets/ou-xian-dns-yu-ming-jie-xi-shi-bai-huo-chao-shi/image-2024-5-8_10-34-3.png)
![](assets/ou-xian-dns-yu-ming-jie-xi-shi-bai-huo-chao-shi/image-2024-5-8_10-34-20.png)
![](assets/ou-xian-dns-yu-ming-jie-xi-shi-bai-huo-chao-shi/image-2024-5-8_10-43-2.png)
![](assets/ou-xian-dns-yu-ming-jie-xi-shi-bai-huo-chao-shi/image-2024-5-8_10-36-53.png)
![](assets/ou-xian-dns-yu-ming-jie-xi-shi-bai-huo-chao-shi/image-2024-5-8_10-44-36.png)
- Environment: ACP v3.6，Kubernetes 集群使用 Kube-OVN CNI，CoreDNS 副本数 6，集群规模数十个节点
- CoreDNS
- Kube-OVN
- net.ipv4.neigh.default.gc_thresh1
- net.ipv4.neigh.default.gc_thresh2
- net.ipv4.neigh.default.gc_thresh3
- conntrack
- OVS conntrack
- Component: CoreDNS
- Page ID: 207398785
- Original Title: 偶现 DNS 域名解析失败或超时
