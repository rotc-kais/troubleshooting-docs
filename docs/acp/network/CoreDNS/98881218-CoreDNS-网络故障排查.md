---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# CoreDNS 网络故障排查

CoreDNS pod 非 running 状态 容器内域名解析失败 宿主机 nslookup 服务名失败

## Cause
- Linux 内核处理 UDP 包的竞争问题
- coredns configmap 配置错误
- kube-proxy 工作异常
- CNI 网络插件异常
- 宿主机 /etc/resolv.conf 配置错误
- iptables 规则存在脏记录

## Resolution
- 检查并修复 /etc/resolv.conf 配置
- 调整 coredns configmap 的 forward 配置：
forward . 172.28.29.201:53 118.118.118.9:53 202.98.192.67:53 {
    policy sequential
    max_fails 3
}
- 重启 kube-proxy
- 检查并修复 CNI 网络插件
- 在 Debian 系容器中修改 /etc/resolv.conf 添加 options: single-request-reopen 或 use-vc
- 禁用 IPv6

## [workaround]
- 将 coredns 实例数缩容到 1 个进行测试
- 对于 Alpine 容器禁用 IPv6

## [Related Information]
- Environment: 3.6
- kube-dns svc ip (如 10.96.0.10)
- kube-system/coredns configmap
- /etc/resolv.conf
- iptables
- kube-proxy
- monkey-cni
- CNI 网络插件
- Component: CoreDNS
- Page ID: 98881218
- Original Title: CoreDNS 网络故障排查
