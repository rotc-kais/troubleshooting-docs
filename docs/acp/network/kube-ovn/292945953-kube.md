---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# kube

新增的networkpolicy不生效

## Cause
- kube-ovn 1.9版本将acl改为apply-after-lb后，旧ACL保留在ls_in_acl表(优先级3000)，新ACL生成在ls_in_acl_after_lb表，导致流量被旧ACL的drop规则拦截

## Resolution
- 删除所有ACL后重启kube-ovn-controller
- 使用脚本删除全部ACL: kubectl ko nbctl acl-del $pg 和 kubectl ko nbctl acl-del $ls
- 使用指定namespace和networkpolicy的脚本删除特定ACL: kubectl ko nbctl acl-del $uuid

## [workaround]
- 删除所有ACL并重启kube-ovn-controller

## [Related Information]
- Environment: CNI版本从kube-ovn 1.9升级到1.12
- port_group
- logical_switch
- ls_in_acl
- ls_in_acl_after_lb
- parentKey
- kube-ovn-controller
- Component: kube-ovn
- Page ID: 292945953
- Original Title: kube-ovn 从1.9 升级高版本新增的networkpolicy 放行规则不生效。
