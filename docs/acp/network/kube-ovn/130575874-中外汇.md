---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# 中外汇

**删除及回退ovnlb操作影响**：服务重建过程中的新建 Pod、Service存在无法正常创建或访问的短暂影响 影响范围：服务重建过程中的新建 Pod、Service存在无法正常创建或访问的短暂影响。

## Cause

## Resolution
- 现场问题容所在集群ovn组件升级到1.8.14版本后，需要对问题容器进行删除ovnlb的动作，从而解决问题java应用业务容器JDBC永久阻塞问题。
- **删除 OVN LB 后的潜在影响**：Pod通过 clusterip访问Service时，需要额外做一次SNAT，service端建立的tcp连接的源IP不是client端的 Pod IP
- * **删除OVN LB方案**
- **备注：需要在OVN升级完成后执行**
- | 1. kubectl -n kube-system edit deploy kube-ovn-controller，修改参数 enable-lb 为 false。
- 2. kube-ovn-controller 自动重建完成后，执行 kubectl -n kube-system get ep | grep nb，获取 endpoint 的 IP 地址，kubectl -n kube-system get po -o wide 找到这个 IP 对应的 ovn-central Pod，
- 3. 功能的验证 （1）基础网络检查，检查业务容器网络通信情况是否正常 （2）kube-ovn-controller是否已正常running启动 |
- * **删除OVN LB回退方案**
- 执行 kubectl -n kube-system edit deploy kube-ovn-controller 修改容器参数 --enable-lb=true 。
- 修改完成后，执行 kubectl -n kube-system rollout status deploy kube-ovn-controller 等待 kube-ovn-controller 重启，重启后原删除的ovn lb会自动还原

## [workaround]

## [Related Information]
- Pod
- Component: kube-Ovn
- Page ID: 130575874
- Original Title: 中外汇-ovnlb删除方案
