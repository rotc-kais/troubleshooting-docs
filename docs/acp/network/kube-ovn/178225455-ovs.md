---kind:   - Troubleshootingproducts:    - Alauda Container Platform   - Alauda DevOps   - Alauda AI   - Alauda Application Services   - Alauda Service Mesh   - Alauda Developer PortalProductsVersion:   - 4.1.0,4.2.x---<!-- A type of document that involves encountering a fault, diag...it, performing root cause analysis, and providing solutions. --># ovsovs-vswitchd/ovn-controller CPU 占用达 48.5% ovs-vswitchd 日志出现 'blocked X ms waiting for main to quiesce' 警告 ovs-vswitchd 日志报 'could not open network device XXX_h (No such device)'## Cause- ovs 代码中处理主机网络大量 IP 地址时存在性能问题- kube-ipvs0 接口存在大规模 IP 地址导致处理效率低下## Resolution- 应用代码优化补丁: https://github.com/kubeovn/kube-ovn/pull/3650## [workaround]- 调整 ovs-ovn 的 CPU limit 从 1000m 提高到 2c (临时缓解)## [Related Information]**Screenshots**![image](https://private-user-images.githubusercontent.com/13048299/298079220-19aa3506-6efc-4b71-8155-451e8a4cda55.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MDU5MTQwNjcsIm5iZiI6MTcwNTkxMzc2NywicGF0aCI6Ii8xMzA0ODI5OS8yOTgwNzkyMjAtMTlhYTM1MDYtNmVmYy00YjcxLTgxNTUtNDUxZThhNGNkYTU1LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDAxMjIlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwMTIyVDA4NTYwN1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTc5NjA5MjZjZjJlOTc5ZWVlZjAyY2U4YThiOTk3N2U3YmMxM2ZhNjA1MjU5NzJkNmViZjE2NDJiMGFlYTE3NmUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.NuFvz4OKiiBAROYROA9amkEPOipplMx6_QnLuj6qY-Q)![image](https://private-user-images.githubusercontent.com/13048299/298079438-3e9757ce-27c2-4bb9-b74f-e9803554a664.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MDU5MTQwNjcsIm5iZiI6MTcwNTkxMzc2NywicGF0aCI6Ii8xMzA0ODI5OS8yOTgwNzk0MzgtM2U5NzU3Y2UtMjdjMi00YmI5LWI3NGYtZTk4MDM1NTRhNjY0LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDAxMjIlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwMTIyVDA4NTYwN1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTgwZTQ4ZTkzMmE4N2QwZmZlNTExZDg4OWViNzhlZDU1ODUyZDk0ZDM1YzFlMDQwZTQyNzBiMjYxZTk2MzRjODImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.m10YnXpE88WTkXSp6UHQ8XvDp2MpypZGl6ezTenc9Pk)![image](https://private-user-images.githubusercontent.com/13048299/298267517-0fcfbc1c-b76d-4832-ac79-3c6ac7411816.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MDU5MTQwNjcsIm5iZiI6MTcwNTkxMzc2NywicGF0aCI6Ii8xMzA0ODI5OS8yOTgyNjc1MTctMGZjZmJjMWMtYjc2ZC00ODMyLWFjNzktM2M2YWM3NDExODE2LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDAxMjIlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwMTIyVDA4NTYwN1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTIzYjZiOGJiNjc3MDEwODRmZTVkMzk3NjhjZWQ3ZmI3ZDQxMDhjZDhkZjQ3NGE4ZjBjNjdjYmE2Y2M3ZmIwNTEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.4Z2yUf4aE4VA7TKJ2x7xkXX1SHEQ859r9i2et9juLEA)- ovs-vswitchd- ovn-controller- br-int- kube-ipvs0- /var/run/openvswitch/br-int.mgmt- perf- FlameGraph 脚本- Component: kube-ovn- Page ID: 178225455- Original Title: ovs-vswitchd/ovn-controller CPU 占用过高