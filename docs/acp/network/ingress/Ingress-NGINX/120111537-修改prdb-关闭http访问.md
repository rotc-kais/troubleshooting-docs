---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# 修改prdb 关闭http访问

http无法访问 80端口未关闭

## Cause
- 未正确配置HTTP强制跳转HTTPS
- 残留80端口的frontend和rule资源
- DEFAULT-SSL-STRATEGY配置未更新

## Resolution
- kubectl edit prdb base 设置spec.http.forceRedirectHttps: true和httpPort: 0
- kubectl delete ft -n cpaas-system global-alb2-00080
- kubectl delete rule -n cpaas-system -l 'alb2.cpaas.io/frontend=global-alb2-00080'
- kubectl delete pod -n cpaas-system -l service_name=alb2-global-alb2
- 检查DEFAULT-SSL-STRATEGY值为always

## [workaround]
- kubectl edit deployment -n {ns} {alb-deployment} 修改DEFAULT-SSL-STRATEGY为Always
- 手动删除80端口ft后重启alb

## [Related Information]
- Environment: 3.6/3.8版本
- prdb
- alb2
- global-alb2-00080
- DEFAULT-SSL-STRATEGY
- cpaas-system
- spec.http.forceRedirectHttps
- Component: Ingress NGINX
- Page ID: 120111537
- Original Title: 修改prdb 关闭http访问
