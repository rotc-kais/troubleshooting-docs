---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# 服务内部路由因 X

请求经过F5时触发路由报错 直接通过ALB域名请求调用正常

## Cause
- F5的insert-xff-http-profile自定义逻辑与后端服务X-Forwarded-For头处理不兼容
- ALB配置使用$proxy_add_x_forwarded_for导致X-Forwarded-For头包含客户端IP、F5 IP、Nginx IP

## Resolution
- 注释ALB配置中的proxy_set_header X-Real-IP $remote_addr; 和 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

## [workaround]

## [Related Information]
- Environment: 3.18.1
- X-Forwarded-For
- X-Real-IP
- proxy_set_header
- insert-xff-http-profile
- $proxy_add_x_forwarded_for
- Component: ALB
- Page ID: 314114443
- Original Title: 容器平台-网络-ALB-服务内部路由因 X-Forwarded-For 头信息传递引发报错问题-112492
