---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# Etcd压缩整理操作

etcd数据量较大

## Cause
- etcd旧版本数据积累未压缩

## Resolution
- 拷贝etcdctl工具：docker cp/nerdctl cp
- 设置环境变量：export ETCDCTL_API=3
- 获取最大版本号：rev=$(/usr/bin/etcdctl ... | egrep -o '[0-9].*')
- 执行压缩：etcdctl compact $rev
- 整理空间：/usr/bin/etcdctl defrag
- 验证状态：/usr/bin/etcdctl endpoint status -w table

## [workaround]

## [Related Information]
- Environment: 通用
- 2379
- /etc/kubernetes/pki/etcd/ca.crt
- /etc/kubernetes/pki/etcd/peer.crt
- /etc/kubernetes/pki/etcd/peer.key
- etcdctl
- control-plane,master
- ETCDCTL_API=3
- Component: ETCD
- Page ID: 98889606
- Original Title: Etcd压缩整理操作
