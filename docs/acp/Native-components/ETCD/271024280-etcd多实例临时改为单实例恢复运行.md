---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# etcd多实例临时改为单实例恢复运行

etcd多实例故障需临时切换单实例

## Cause
- etcd集群多实例异常导致不可用

## Resolution
- 停止kubelet和etcd容器: systemctl stop kubelet; docker rm -f etcd容器
- 备份并清理数据: tar cvf /backup_$(data +%Y%m%d%H).tar; mv /var/lib/etcd
- 通过快照恢复单实例: etcdctl snapshot restore --data-dir=/var/lib/etcd --name <ip> --initial-cluster <ip>=<http://ip:2380>
- 重启kubelet: systemctl restart kubelet
- 添加节点到集群: etcdctl member add <ip> --peer-urls=<https://ip:2380>

## [workaround]
- 临时使用单实例模式维持集群运行

## [Related Information]
- Environment: Kubernetes集群使用Docker容器化部署的etcd
- 2380端口(peer通信)
- 2379端口(client通信)
- /var/lib/etcd
- /etc/kubernetes/pki/etcd/healthcheck-client.crt
- etcdctl
- kubelet
- docker
- Component: ETCD
- Page ID: 271024280
- Original Title: etcd多实例临时改为单实例恢复运行
