---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# etcd数据达到2G无法写入数据故障处理方法

etcd数据达到2G无法写入数据导致平台出现异常情况

## Cause
- etcd数据达到2G大小限制（版本2.9长时间未使用生成大量告警信息记录导致数据过大）

## Resolution
- 修改所有etcd节点的--quota-backend-bytes=8589934592并重启
- 导出etcdctl命令: docker cp $(docker ps | grep -w etcd | awk '{print $1}'):/usr/local/bin/etcdctl /usr/bin/
- 关闭alarm告警: etcdctl --endpoints=$ENDPOINTS --cacert=$CACERT --cert=$CERT --key=$KEY alarm disarm
- 清理异常资源: etcdctl --endpoints=$ENDPOINTS --cacert=$CACERT --cert=$CERT --key=$KEY del /registry/aiops.alauda.io/notificationmessages/cpaas-system/ --prefix --command-timeout=900s
- 恢复quota-backend-bytes默认值

## [workaround]

## [Related Information]
- Environment: v2.9
- /etc/kubernetes/manifests/etcd.yaml
- --quota-backend-bytes
- /registry/aiops.alauda.io/notificationmessages
- /etc/kubernetes/pki/etcd/ca.crt
- /etc/kubernetes/pki/etcd/peer.crt
- /etc/kubernetes/pki/etcd/peer.key
- Component: ETCD
- Page ID: 133097215
- Original Title: etcd数据达到2G无法写入数据故障处理方法
