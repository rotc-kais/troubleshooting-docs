---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# 业务集群k8s负载均衡故障临时恢复方案

业务集群通过客户提供的硬件或软件负载设备作为K8S管理组件的负载均衡，当该负载设备出现故障时，会导致集群失联，无法调度容器等问题，需要紧急快速修复集群管理能力。

## Cause

## Resolution
- ## 解决方案
- K8S核心组件kubelet需要对Pod资源进行watch，同时定期上报集群状态到管控中心，均通过K8S负载均衡。该方案只要修改kubelet上报指向的IP地址为Master节点之一（apiserver所在节点即可），同时修改kube-proxy，更新对应的ipvs转发策略即可。
- 1.修改集群内所有节点kubelet配置文件中的vip地址更换为master01节点
- 2.修改kubectl默认的请求地址，把vip地址更换为master01节点
- vi /root/.kube/config
- 3.修改kube-system下的kube-proxy cm中的vip地址更换为master01节点
- kubectl get cm -n kube-system kube-proxy -oyaml > kube-proxy-bak.yaml
- kubectl edit cm -n kube-system kube-proxy
- 1、需IAAS支持配置子接口并可实现K8S流量转发
- 2、确认vip和master01节点网卡配置信息

## [workaround]
- 该方案采用网卡子接口方式，在同网段的网卡上启用子接口绑定VIP地址实现临时转发能力。该方案仅限于VIP地址和Master节点地址同网段，同时需要底层IAAS支持。

## [Related Information]
- 255
- 6443
- pod
- /etc/kubernetes/kubelet.conf
- /root/.kube/config
- /etc/syscofig/network-scripts/ifcfg-eth0
- kubelet
- node
- Component: Kubernetes
- Page ID: 196905261
- Original Title: 业务集群k8s负载均衡故障临时恢复方案
