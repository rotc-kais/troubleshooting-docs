---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# v3.8 registry 匿名可读临时修复方案

registry 允许匿名用户拉取镜像

## Cause
- auth.yaml 配置中 _anonymous 权限未正确限制
- registry.yaml 缺失 auth 容器导致认证未生效

## Resolution
- 修改 /etc/kubernetes/registry/auth.yaml 添加 rotc 用户并配置 _anonymous 权限
- 检查 /etc/kubernetes/manifests/registry.yaml 确保存在 auth 容器
- 同步配置文件到所有 master 节点
- 执行 'docker ps | grep registry|awk '{print $1}' | xargs docker rm -f' 重启容器
- 使用 'kubectl get po -n kube-system | grep -I registry' 确认恢复
- 在所有节点执行 docker login 更新凭证

## [workaround]

## [Related Information]
- Environment: v3.8 registry 环境，Kubernetes master 节点
- /etc/kubernetes/registry/auth.yaml
- /etc/kubernetes/manifests/registry.yaml
- auth 容器
- registry 容器
- minio
- 60080
- 5000
- 9000
- users
- auths
- actions
- Component: Kubernetes
- Page ID: 227247627
- Original Title: v3.8 registry 匿名可读临时修复方案
