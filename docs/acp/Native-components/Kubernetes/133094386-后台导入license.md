---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# 后台导入license

JIRA Jira：

## Cause

## Resolution
- 登录master第一台节点获取token：1) 界面个人中心获取 2) 3.8前版本使用命令 `kubectl -n cpaas-system describe secret $(kubectl -n cpaas-system get secret | grep default-token | awk '{print $1}') | awk '/token:/ {print $2}'` 3) 后续版本创建admin-user SA后通过 `kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin-user | awk '{print $1}') | awk '/token:/ {print $2}'` 获取
- 3.0版本操作：替换127.0.0.1为VIP/master1 IP后执行 `curl -k https://127.0.0.1/lic/v1/metadata -H "Authorization: Bearer $TOKEN"` 获取元数据，`curl -k https://127.0.0.1/lic/v1/licenses -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/octet-stream" -X POST -d "license内容"` 导入，`curl -k http://127.0.0.1/lic/v1/licenses -H "Authorization: Bearer $TOKEN" -X GET` 查看
- 3.8版本操作：替换127.0.0.1为VIP/master1 IP后执行 `curl -k https://127.0.0.1/lic/v2/metadata -H "Authorization: Bearer $TOKEN"` 获取证书格式，`curl 'https://127.0.0.1/lic/v2/licenses' -H 'accept: application/json, text/plain, */*' -H 'authorization: Bearer $TOKEN' -H 'content-type: application/octet-stream' -H 'x-license-kind: license' -H 'x-license-password: acvdef' -d "license需求文件" --insecure -X POST` 导入，`curl -k http://127.0.0.1/lic/v2/licenses -H "Authorization: Bearer $TOKEN" -X GET` 查看

## [workaround]

## [Related Information]
- Environment: 3.0, 3.8
- /lic/v1/metadata
- /lic/v1/licenses
- /lic/v2/metadata
- /lic/v2/licenses
- kubectl describe secret
- ServiceAccount:admin-user
- ClusterRoleBinding:admin-user
- x-license-kind
- x-license-password
- Component: Kubernetes
- Page ID: 133094386
- Original Title: 容器平台-后台导入license
