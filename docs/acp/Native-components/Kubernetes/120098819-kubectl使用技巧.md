---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# kubectl使用技巧

kubectl命令无法自动补全 查看所有命名空间资源时命令冗长 需要高效查看和筛选Kubernetes资源

## Cause
- 未配置shell的kubectl自动补全
- 使用--all-namespaces参数而非更简洁的-A
- 不熟悉kubectl的高级查询和筛选参数

## Resolution
- source <(kubectl completion bash) 或 source <(kubectl completion zsh)
- kubectl get pod -A
- kubectl get services
- kubectl get pods --all-namespaces
- kubectl get pods -o wide
- kubectl get deployment my-dep
- kubectl get pod my-pod -o yaml
- kubectl describe nodes my-node
- kubectl describe pods my-pod
- kubectl get services --sort-by=.metadata.name
- kubectl get pods --sort-by='.status.containerStatuses[0].restartCount'
- kubectl get pv --sort-by=.spec.capacity.storage
- kubectl get pods --selector=app=cassandra -o jsonpath='{.items[*].metadata.labels.version}'
- kubectl get configmap myconfig -o jsonpath='{.data.ca\.crt}'
- kubectl get node --selector='!node-role.kubernetes.io/control-plane'
- kubectl get pods --field-selector=status.phase=Running
- kubectl get nodes -o jsonpath='{.items[*].status.addresses[?(@.type=="ExternalIP")].address}'
- kubectl get pods --show-labels
- kubectl get nodes -o jsonpath="$JSONPATH" | grep "Ready=True"
- kubectl get secret my-secret -o go-template='{{range $k,$v := .data}}{{"### "}}{{$k}}{{"\n"}}{{$v|base64decode}}{{"\n\n"}}{{end}}'
- kubectl get pods -o json | jq '.items[].spec.containers[].env[]?.valueFrom.secretKeyRef.name' | grep -v null | sort | uniq
- kubectl get pods --all-namespaces -o jsonpath='{range .items[*].status.initContainerStatuses[*]}{.containerID}{"\n"}{end}' | cut -d/ -f3
- kubectl get events --sort-by=.metadata.creationTimestamp
- kubectl diff -f ./my-manifest.yaml
- kubectl get nodes -o json | jq -c 'paths|join(".")'
- kubectl get pods -o json | jq -c 'paths|join(".")'
- for pod in $(kubectl get po --output=jsonpath={.items..metadata.name}); do echo $pod && kubectl exec -it $pod -- env; done
- kubectl get deployment nginx-deployment --subresource=status

## [workaround]

## [Related Information]
- Environment: 通用
- kubectl
- bash
- zsh
- jsonpath
- jq
- node-role.kubernetes.io/control-plane
- selector
- configmap
- secret
- initContainer
- go-template
- Component: Kubernetes
- Page ID: 120098819
- Original Title: kubectl使用技巧
