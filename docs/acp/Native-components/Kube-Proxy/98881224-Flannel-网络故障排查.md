---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# Flannel 网络故障排查

宿主机无法访问其他节点的Pod IP Pod内部无法访问Service地址 Flannel Pod运行异常

## Cause
- Flannel Pod未正常运行
- kube-proxy异常
- 多网卡环境下Flannel使用默认路由的网卡
- iptables中存在DROP规则
- 防火墙阻止UDP端口8285/8472或Pod CIDR流量
- MTU设置不正确
- 配置文件格式错误或路径错误
- 节点未分配podCIDR
- RBAC未正确配置

## Resolution
- 检查Flannel Pod状态并修复
- 检查kube-proxy日志并排除异常
- 在Flannel配置中增加`--iface=eth1`参数
- 使用`iptables -L -n`检查并清除KUBE-FIREWALL表中的DROP规则
- 配置防火墙允许UDP端口8285/8472及Pod CIDR流量
- 检查网络接口MTU及subnet.env文件配置
- 修正`/etc/cni/net.d/10-flannel.conflist`文件为有效JSON格式
- 确保节点分配podCIDR
- 配置RBAC允许Flannel访问Kubernetes API

## [workaround]

## [Related Information]
- Environment: 3.6
- 8285
- 8472
- /etc/cni/net.d/10-flannel.conflist
- flanneld
- kube-proxy
- etcd
- --iface
- subnet.env
- KUBE-FIREWALL
- Component: Kube-Proxy
- Page ID: 98881224
- Original Title: Flannel 网络故障排查
