---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# Join子网无接入Node的端口

从节点 ping join 子网网关或 pod 不通 nbctl show join 显示 join 子网无接入节点的端口

## Cause
- kube-ovn-controller 未正确将节点 ovn0 接入 join 子网
- ovn-cluster 静态路由缺失

## Resolution
- 执行命令手动接入节点端口: kubectl ko nbctl lsp-add join node-NODENAME -- lsp-set-addresses node-NODENAME "OVN0MAC OVN0IP"
- 检查并手动添加 ovn-cluster 静态路由: kubectl ko nbctl --policy=dst-ip lr-route-add ovn-cluster 192.168.16.91 100.64.0.3
- 重建非 HostNetwork 模式 Pod: for ns in $(kubectl get ns --no-headers -o  custom-columns=NAME:.metadata.name); do for pod in $(kubectl get pod --no-headers -n "$ns" --field-selector spec.restartPolicy=Always -o custom-columns=NAME:.metadata.name,HOST:spec.hostNetwork | awk '{if ($2!="true") print $1}'); do kubectl delete pod "$pod" -n "$ns" --ignore-not-found; done; done

## [workaround]

## [Related Information]
- Environment: Kubernetes cluster with kube-ovn CNI plugin
- kube-ovn-cni
- kube-ovn-controller
- ovn0
- join 子网
- ovn-cluster 路由表
- nbctl show join
- nbctl lr-route-list ovn-cluster
- Component: Node
- Page ID: 91232771
- Original Title: Join子网无接入Node的端口
