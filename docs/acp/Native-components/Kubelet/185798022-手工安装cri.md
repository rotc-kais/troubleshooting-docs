---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# 手工安装cri

systemctl status kubelet 显示服务无法运行 kubelet 日志包含 'unable to determine runtime API version' 错误 docker ps 和 docker images 显示存在 pod 相关容器和镜像

## Cause
- 升级过程中自动添加 cri-docker 服务失败

## Resolution
- scp /etc/systemd/system/cri-docker.{service,socket} 和 /usr/bin/cri-dockerd 到故障节点
- 执行 systemctl daemon-reload && systemctl enable cri-docker.{service,socket} && systemctl restart cri-docker.{socket,service}
- 修改 /var/lib/kubelet/kubeadm-flags.env：移除 --network-plugin=cni，按版本添加 --container-runtime-endpoint=unix:///run/cri-dockerd.sock 等参数
- 执行 systemctl restart kubelet

## [workaround]

## [Related Information]
- Environment: 3.12.x/3.14.x 版本升级场景，使用 docker 作为容器运行时的 Kubernetes 集群升级到 1.24.x
- cri-docker.service
- cri-docker.socket
- kubeadm-flags.env
- container-runtime-endpoint
- container-log-max-files
- container-log-max-size
- container-runtime=remote
- Component: Kubelet
- Page ID: 185798022
- Original Title: 手工安装cri-docker服务
