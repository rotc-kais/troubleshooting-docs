---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# Kafka集群非持久化修复

服务器重启导致Kafka集群数据丢失 Zookeeper数据丢失导致Kafka集群Crash

## Cause
- Kafka Operator默认创建非持久化配置
- Zookeeper未配置持久化导致元数据不一致

## Resolution
- 在Kafka和Zookeeper的storage配置段添加持久化配置
- 添加`deleteClaim: false`参数防止PV/PVC被删除
- 备份Kafka集群CR文件后删除旧实例
- 使用持久化配置重新创建Kafka集群实例
- 执行`kubectl delete pod`强制重启所有Kafka Pod
- 删除各节点`meta.properties`文件修复元数据

## [workaround]

## [Related Information]
**Screenshots**
![image-20211202105525001](http://cdn.xnginx.com//image/image-20211202105525001.png)
![image-20211202105633018](http://cdn.xnginx.com//image/image-20211202105633018.png)
![image-20211202110245009](http://cdn.xnginx.com//image/image-20211202110245009.png)
![image-20211202110335070](http://cdn.xnginx.com//image/image-20211202110335070.png)
![image-20211202110600581](http://cdn.xnginx.com//image/image-20211202110600581.png)
- Environment: Kafka 3.4.x, 3.6.x
- storage.type
- deleteClaim
- persistent-claim
- topolvm
- local-path
- kafka-log0
- meta.properties
- kafka-bootstrap
- Component: Kubelet
- Page ID: 127433815
- Original Title: 数据服务-Kafka集群非持久化修复
