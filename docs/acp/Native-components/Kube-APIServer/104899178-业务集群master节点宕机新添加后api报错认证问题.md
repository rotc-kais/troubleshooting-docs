---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# 业务集群master节点宕机新添加后api报错认证问题

Unable to authenticate the request invalid bearer token

## Cause
- 残留的etcd成员未清理
- 缺少必要的认证文件（known_tokens.csv, oidc-ca.crt）
- kube-apiserver未配置token-auth-file参数

## Resolution
- 删除故障master节点
- 清理etcd中残留的故障节点成员
- 初始化新节点并保持IP不变
- 重新添加控制节点
- 复制known_tokens.csv和oidc-ca.crt到新节点，修改kube-apiserver.yaml添加--token-auth-file参数并重启API服务
- 检查API日志及平台状态

## [workaround]

## [Related Information]
- Environment: 升级上来的3.6.x版本，重新添加业务集群master
- etcd
- kube-apiserver
- /etc/kubernetes/known_tokens.csv
- /etc/kubernetes/pki/oidc-ca.crt
- --token-auth-file=/etc/kubernetes/known_tokens.csv
- Component: Kube-APIServer
- Page ID: 104899178
- Original Title: 业务集群master节点宕机新添加后api报错认证问题
