---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# 康宝莱证书替换方案

SSL Certificate Signature Verification Failed Vulnerability Port SSL Certificate Self-Signed Certificate Port SSL Certificate Subject Common Name Does Not Match Server

## Cause
- 自签证书不被安全扫描软件信任
- 证书FQDN不匹配
- 证书有效期超过一年

## Resolution
- 提供/etc/kubernetes/pki/ca.crt和ca.key给安全扫描软件授信
- 使用server.sh生成新证书并分发到所有master节点
- 替换apiserver/controller-manager/scheduler证书并重启对应组件
- 在所有节点生成kubelet证书并重启kubelet服务
- 业务集群执行kubectl apply -f /tmp/ssl/log-cert.yaml
- global集群执行kubectl apply -f /tmp/ssl/dex-cert.yaml并重启registry-auth组件

## [workaround]

## [Related Information]
**Screenshots**
[![](assets/kang-bao-lai-zheng-shu-ti-huan-fang-an/placeholder-medium-file.png)](/download/attachments/216107061/server.sh?version=2&modificationDate=1718932943000&api=v2)
- Environment: Kubernetes集群环境，包含3个master节点，使用docker或containerd运行时，区分业务集群和global集群，证书有效期为1年
- 6443
- 10257
- 10259
- 10250
- 11781
- 443
- 11443
- /etc/kubernetes/pki
- /etc/kubernetes/manifests/kube-controller-manager.yaml
- /etc/kubernetes/manifests/kube-scheduler.yaml
- kube-apiserver
- kube-controller-manager
- kube-scheduler
- kubelet
- cpaas-ca
- Component: Kube-APIServer
- Page ID: 216107061
- Original Title: 康宝莱证书替换方案
