---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# kube

kube-apiserver pod 运行时间超过一年 kube-apiserver 日志出现 https://[::1]:6443 或 https://127.0.0.1:6443 证书过期错误 检查到 loopback 证书过期时间超过一年

## Cause
- loopback 证书有效期一年且仅在启动时签发
- HTTP2 长连接未触发证书重新校验
- 已建立连接未断开导致证书过期后仍可通信

## Resolution
- 依次在每台控制节点执行容器删除命令：containerd 运行时使用 `crictl ps |grep kube-apiserver- | awk '{print $1}' | xargs crictl rm -f`
- docker 运行时使用 `docker ps |grep k8s_kube-apiserver_ | awk '{print $1}' | xargs docker rm -f`

## [workaround]

## [Related Information]
- Environment: 所有版本
- 6443
- /healthz
- kube-apiserver
- apiserver-loopback-client
- loopback 证书
- Component: Kube-APIServer
- Page ID: 247496984
- Original Title: kube-apiserver 运行超过一年时必须重启一次
