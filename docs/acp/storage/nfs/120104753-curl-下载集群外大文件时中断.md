---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# curl 下载集群外大文件时中断

Pod中通过curl下载集群外大文件（1GB）时出现connection reset by peer错误 节点上直接使用curl下载正常，Pod中限速10MB/s后问题消失

## Cause
- SNAT阶段触发TCP连接异常
- nf_conntrack_tcp_be_liberal参数未开启导致out of window包被标记为INVALID状态

## Resolution
- echo 1 > /proc/sys/net/netfilter/nf_conntrack_tcp_be_liberal
- 旧版本内核使用：echo 1 > /proc/sys/net/ipv4/netfilter/ip_conntrack_tcp_be_liberal

## [workaround]
- 在节点添加iptables规则和路由使Pod流量绕过SNAT

## [Related Information]
- nf_conntrack_tcp_be_liberal
- iptables
- conntrack
- /proc/sys/net/netfilter/nf_conntrack_tcp_be_liberal
- SNAT
- Component: NFS
- Page ID: 120104753
- Original Title: curl 下载集群外大文件时中断 - connection reset by peer
