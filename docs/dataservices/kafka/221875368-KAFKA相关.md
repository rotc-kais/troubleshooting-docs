---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# KAFKA相关

消费者组无法提交偏移量(offset) 生产者发送消息超时(TimeoutException) Topic的ISR(In-Sync Replicas)列表频繁收缩

## Cause
- Broker配置中`offsets.topic.replication.factor`值低于可用Broker数量
- Broker与Zookeeper间网络延迟超过`zookeeper.session.timeout.ms`设置值
- Broker磁盘IOPS达到瓶颈导致`LogFlushStats`异常增高

## Resolution
- 通过`kafka-configs.sh --entity-type brokers --alter --add-config offsets.topic.replication.factor=3`调整副本因子
- 使用`mtr -rwzc20 -P 2181 zookeeper-host`进行持续性网络质量检测
- 监控磁盘指标：`iostat -xmt 1` 和 `kafka.server:type=LogFlushStats,name=LogFlushRateAndTimeMs`
- 滚动重启Broker：`kafka-server-stop.sh && kafka-server-start.sh -daemon config/server.properties`

## [workaround]
- 临时将生产者确认机制设为`acks=1`：`properties.put("acks", "1");`
- 调整消费者自动提交间隔：`auto.commit.interval.ms=60000`

## [Related Information]
- Environment: Kafka 2.8.0 集群运行在Kubernetes 1.22环境，使用KRaft模式（无ZooKeeper）
- Kafka Broker
- Zookeeper
- 生产者客户端
- 消费者客户端
- server.properties
- replica.lag.time.max.ms
- num.io.threads
- log.dirs
- Component: kafka
- Page ID: 221875368
- Original Title: KAFKA相关
