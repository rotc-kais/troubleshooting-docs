---
kind:
  - Troubleshooting
products:
  - Alauda Container Platform
  - Alauda DevOps
  - Alauda AI
  - Alauda Application Services
  - Alauda Service Mesh
  - Alauda Developer Portal
ProductsVersion:
  - 4.1.0,4.2.x
---
<!-- A type of document that involves encountering a fault, diagnosing it, performing root cause analysis, and providing solutions. -->

# 常用内核参数说明

丢包问题 syn 不回包 内存被占满触发 OOM

## Cause
- net.ipv4.tcp_tw_recycle 开启导致时间戳检查引发丢包
- net.core.somaxconn 值过小导致队列满
- vm.vfs_cache_pressure 配置不当导致 dentry 积累
- vm.dirty_ratio 达到阈值触发同步写阻塞
- net.ipv4.tcp_keepalive 默认值过大
- net.ipv4.neigh.default.gc_thresh3 设置过低

## Resolution
- 关闭 net.ipv4.tcp_tw_recycle
- 增大 net.core.somaxconn 值
- 调整 vm.vfs_cache_pressure=250
- 降低 vm.dirty_ratio 值
- 调整 net.ipv4.tcp_keepalive_time=1800, tcp_keepalive_intvl=30, tcp_keepalive_probes=3
- 增大 net.ipv4.neigh.default.gc_thresh3

## [workaround]
- 启用 net.ipv4.tcp_syncookies=1 防御 SYN 攻击
- 临时调整 net.ipv4.ip_local_port_range 扩大端口范围
- 设置 vm.min_free_kbytes 为总内存 1%

## [Related Information]
- Environment: 通用
- net.ipv4.tcp_tw_recycle
- net.core.somaxconn
- vm.vfs_cache_pressure
- vm.dirty_ratio
- net.ipv4.tcp_keepalive_time
- net.ipv4.neigh.default.gc_thresh3
- /etc/security/limits.conf
- tcp_rmem
- tcp_wmem
- Component: redis
- Page ID: 120111072
- Original Title: 常用内核参数说明
